---
/*
  src/components/Comments.astro
*/
---

<section class="giscus-section">
  <div class="giscus"></div>
</section>

<script
  src="https://giscus.app/client.js"
  data-repo="Egehan134/egehanyamci.dev" 
  data-repo-id="R_kgDORLXh1Q"
  data-category="Announcements"
  data-category-id="DIC_kwDORLXh1c4C2ndb"
  data-mapping="pathname"
  data-strict="0"
  data-reactions-enabled="0"
  data-emit-metadata="0"
  data-input-position="top"
  data-theme="preferred_color_scheme"
  data-lang="en"
  data-loading="lazy"
  crossorigin="anonymous"
  async>
</script>

<script>
  // Listens for theme changes and notifies Giscus
  function updateGiscusTheme() {
    const theme = document.documentElement.getAttribute('data-theme');
    const iframe = document.querySelector('iframe.giscus-frame') as HTMLIFrameElement;
    
    if (!iframe) return;

    // Giscus themes matching the site's theme
    let giscusTheme = 'transparent_dark'; // Default: dark
    
    if (theme === 'light') {
      giscusTheme = 'light';
    } else if (theme === 'tokyo') {
      giscusTheme = 'dark_dimmed'; 
    } else if (theme === 'gruvbox'){
    { giscusTheme = 'gruvbox'; }
    }

    // Send message to the Giscus iframe
    iframe.contentWindow?.postMessage(
      { giscus: { setConfig: { theme: giscusTheme } } },
      'https://giscus.app'
    );
  }

  // Run on page load (script already sets initial theme, but add this just in case)
  // When the theme toggle button is clicked (ThemeToggle.astro changes the attribute)
  // Observe attribute changes:
  const observer = new MutationObserver((mutations) => {
    mutations.forEach((mutation) => {
      if (mutation.type === 'attributes' && mutation.attributeName === 'data-theme') {
        updateGiscusTheme();
      }
    });
  });

  observer.observe(document.documentElement, {
    attributes: true,
    attributeFilter: ['data-theme']
  });
</script>

<style>
  .giscus-section {
    margin-top: 1rem;
    width: 100%;
  }
</style>